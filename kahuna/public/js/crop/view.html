<gr-top-bar>
    <gr-top-bar-nav>
        <a class="top-bar-item"
           ui:sref="image({ imageId: ctrl.image.data.id })">
            <gr-icon>cancel</gr-icon><span class="top-bar-item__label">cancel</span></a>
    </gr-top-bar-nav>

    <gr-top-bar-actions>
        <div class="top-bar-item top-bar-item--static">{{ ctrl.cropWidth() }} &times; {{ ctrl.cropHeight() }}</div>

        <span ng:repeat="ratio in ctrl.ratios">
            <input type="radio"
                   id="crop_{{ratio.label}}"
                   class="radio-list__circle"
                   name="crop-aspect"
                   ng:value="ratio.value"
                   ng:model="ctrl.aspect">
            <label for="crop_{{ratio.label}}"
                   class="top-bar-item radio-list__label radio-list__crop-item"
                   ng:class="{'radio-list--selected': ctrl.aspect === ratio.value}">
                <div class="radio-list__selection-state"></div>
                <div class="radio-list__crop-item__label">
                    <gr-icon>{{ratio.icon}}</gr-icon>
                    <span class="top-bar-item__label">
                        {{ratio.label}}
                        <span ng:if="ratio.value !== null">({{::ctrl.getRatioString(ratio.value)}})</span>
                    </span>
                </div>
            </label>
        </span>

        <div class="top-bar-item top-bar-item--full" ng:switch="ctrl.image.data.cost">
            <div ng:switch-when="pay"
                 class="cost cost--pay">
                pay to use
            </div>

            <div ng:switch-when="conditional"
                 class="cost cost--conditional"
                 title="restricted use: {{ctrl.image.data.usageRights.restrictions}}">
                <!-- As `conditional` can only be set with usageRights, let's
                     just assume it's here. We might need to revisit this. -->
                <gr-icon>flag</gr-icon>
                <span class="top-bar-item__label">restricted use</span>
                <gr-icon>help</gr-icon>
            </div>
        </div>

        <div class="top-bar-item">
            <button class="button crop__action"
                    type="button"
                    ng:click="ctrl.crop()"
                    ng:disabled="ctrl.cropping">
                <gr-icon>crop</gr-icon><span class="top-bar-item__label">crop<span ng:show="ctrl.cropping">pingâ€¦</span></span>
            </button>
        </div>
    </gr-top-bar-actions>
</gr-top-bar>

<div class="warning" ng:if="ctrl.cropSizeWarning()">
    This crop is very small and will result in a low-quality image.
    Please try to use a larger crop.
</div>

<div class="easel">
    <div class="easel__canvas">
        <img class="easel__image"
             ng:src="{{ctrl.optimisedImageUri}}"
             ui:crop-box="ctrl.coords"
             ui:crop-box-original-width="ctrl.originalWidth"
             ui:crop-box-original-height="ctrl.originalHeight"
             ui:crop-box-aspect="ctrl.aspect"
             ui:crop-box-background-opacity="0.3"

             grid:track-image="ctrl.image"
             grid:track-image-location="original-cropping"
             grid:track-image-loadtime

             gr:image-fade-on-load
        />
    </div>
</div>
